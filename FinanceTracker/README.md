# FinanceTracker

FinanceTracker 是一个个人财务管理应用，基于 SwiftUI 开发，帮助用户跟踪和管理个人财务状况。

## 功能特性

- 账户管理：支持多种类型的账户（现金、银行卡、信用卡等）
- 交易记录：记录收入和支出交易
- 借贷管理：跟踪借入和借出款项
- 分类统计：对收支进行分类管理，支持两级分类（主分类和子分类）
- 成员管理：支持多成员财务管理
- 数据可视化：提供财务数据分析和图表展示
- 多设备同步：支持 iCloud 同步数据
- 数据备份与恢复：支持将数据备份为CSV格式文件（可被Excel打开），并可从CSV文件恢复数据

## 项目结构

```
FinanceTracker/
├── Models/                 # 数据模型
├── Views/                  # 视图组件
├── ViewModels/             # 视图模型
├── Services/               # 数据服务
├── Utils/                  # 工具类
└── Assets.xcassets/        # 图片资源
```

## 更新日志

### 2025-12-25

#### 功能增强
- 实现了转账功能，在首页快速记录中增加了转账按钮
- 转账弹窗中可以选择从哪个账户转到哪个账户，选择成员、时间、备注等信息
- 转账记录在流水中显示为"转账"分类，不参与收入和支出统计
- 修改了收入和支出的颜色显示：收入使用红色，支出使用绿色
- 修改了借贷图标，使用圆形铜币图标替代原来的箭头图标

#### Bug 修复
- 修复了添加转账功能时出现的编译错误，解决了对私有属性的访问问题
- 修复了转账记录在流水中显示为"未知分类"的问题，确保使用正确的转账分类

### 2025-12-24

#### 新功能实现
- 修改了备份格式为CSV格式（可被Excel打开）
- 实现了两级分类功能，支持主分类和子分类
- 更新了备份和恢复功能以支持新的CSV格式
- 添加了分类管理视图，支持添加、编辑和删除两级分类
- 保持向后兼容性，仍可读取旧的JSON格式备份

### 2025-12-23

#### 新功能实现
- 实现了本地备份和恢复功能
- 用户可以在设置页面创建数据备份文件，备份包含所有账户、交易、分类、借贷、收入分配和成员信息
- 用户可以从备份文件列表中选择并恢复数据
- 备份文件存储在应用文档目录中，文件名包含时间戳便于识别
- 支持从外部导入备份文件到应用中进行恢复
- 提供了清理备份文件的功能
- 增加了诊断功能，可以检查文档目录中的备份文件

### 2025-12-22

#### Bug 修复
- 修复了统计页面中 Decimal 类型无法直接转换为 CGFloat 的编译错误
- 解决了 RankingItem 视图中无法访问外部 formatCurrency 方法的问题
- 通过添加辅助方法和类型转换确保图表正确显示数据

### 2025-12-21

#### 新功能实现
- 完整实现了统计分析功能页面
- 支持按天、周、月、年四种时间维度查询统计信息
- 提供资金趋势图表展示，显示收入、支出变化趋势
- 包含详细的统计摘要信息：总收入、总支出、净收入、借入、借出、净存款
- 实现收入和支出排行榜功能，按分类展示排行
- 添加借贷统计模块，展示借入借出情况
- 提供年份和月份选择器，方便用户查看不同时间段的数据

### 2025-12-20

#### 界面优化
- 重新设计了流水页面的整体布局，提升视觉效果和用户体验
- 优化了分组头部样式，使用卡片式设计展示统计信息
- 改进了交易记录和贷款记录的显示方式，采用图标+详情的布局
- 统一了颜色方案，使收入、支出和借贷记录的颜色表达更加一致
- 增强了分组展开/收缩按钮的视觉效果

### 2025-12-19

#### 功能增强
- 增加了分组展开/收缩功能，用户可以控制每个分组的显示状态
- 在分组标题右侧添加了统计信息显示，包括总收入、总支出和净收入
- 统计信息根据当前视图模式（天、周、月、年）动态计算和显示
- 优化了分组交互体验，使用户能够更好地查看和管理交易记录

### 2025-12-18

#### 功能增强
- 恢复了交易记录中的天、周、月、年分组功能
- 在交易记录页面右上角添加了分组模式选择菜单
- 支持按不同时间维度（天、周、月、年）查看和分组交易记录
- 每种分组模式都有相应的标题格式化显示
- 修复了工具栏按钮顺序问题，确保分组按钮可见

#### Bug 修复
- 修复了 ForEach 循环中 Any 类型不符合 Hashable 协议的编译错误
- 通过使用数组索引作为标识符解决了该问题

### 2025-12-17

#### Bug 修复
- 修复了新增交易记录后仍然需要重启应用才能看到更新的根本问题
- 解决了借贷记录无法在流水中显示的问题
- 修改了 TransactionViewModel 以支持加载和显示借贷记录
- 在 TransactionsView 中添加了借贷记录的显示支持

### 2025-12-16

#### Bug 修复
- 修复了新增交易记录后仍然需要重启应用才能看到更新的问题
- 优化了通知发送机制，确保在 TransactionsView 中正确处理交易添加后的刷新逻辑
- 移除了重复的通知发送，避免不必要的刷新操作

### 2025-12-15

#### Bug 修复
- 修复了新增交易记录后需要重启应用才能看到更新的问题
- 在 AddTransactionView 的保存操作中添加了交易更新通知的发送机制
- 确保交易数据变更能实时同步到流水页面，无需重启应用

### 2025-12-14

#### Bug 修复
- 修复了流水页面中最新交易记录显示位置不正确的问题
- 确保在所有视图模式下（天、周、月、年），最新的交易记录都显示在列表的最上方
- 改进了分组内交易记录的排序逻辑

### 2025-12-13

#### 功能增强
- 在流水页面中实现了交易记录倒序排列，最新的记录显示在最上面
- 在流水页面中增加了天、周、月、年视图选项，支持按不同时间维度查看交易记录
- 每种视图模式下都有相应的分组和标题格式，提升用户体验

### 2025-12-12

#### 功能增强
- 在支出页面的账户选择器中添加了账户余额显示功能
- 用户在选择支出账户时可以直观看到每个账户的当前余额
- 提升了用户体验，帮助用户更好地管理支出

### 2025-12-11

#### Bug 修复
- 修复了在账户管理中修改收入分配比例后点击保存按钮无法保存的问题
- 在 AccountEditView 和 AllocationRowView 中添加了保存后发送通知的机制
- 修复了 HomeView 中缺少对交易更新通知监听的问题
- 确保所有数据变更都能实时同步到相关视图

### 2025-12-10

#### Bug 修复
- 修复了 PersistentDataService 中缺少 DataServiceError 定义导致的编译错误
- 在 PersistentDataService 中添加了完整的错误类型定义，包括交易、账户、分类、借贷、分配和成员相关的错误

### 2025-12-09

#### Bug 修复
- 修复了新增流水后在流水页面没有及时更新的问题
- 修复了首页中的账户余额信息、总存款、净存款、借入、借出一直是0美元的问题
- 修复了新增账户、分类后需要重启app才能在新增流程页面中选择的问题
- 实现了完整的实时数据同步机制，包括账户、分类、成员和交易数据的实时更新
- 在 PersistentDataService 中实现了交易对账户余额的实时计算和更新

### 2025-12-08

#### Bug 修复
- 修复了收入新增页面中输入金额后收入分配预览不更新的问题
- 修复了新增分类后收入/支出页面无法及时更新分类列表的问题
- 在收入和支出表单页面中添加了对分类更新通知的监听机制
- 改进了收入分配预览的实时更新功能

### 2025-12-07

#### Bug 修复
- 修复了添加分类、账户、成员等信息后需要重启应用才能在首页看到更新的问题
- 为所有数据模型（Account、Category、Member）添加了 Equatable 协议支持
- 在设置页面中实现了完整的通知机制，确保数据变更能实时同步到首页
- 首页现在能监听账户、分类和成员的变更通知，并自动刷新数据

### 2025-12-06

#### Bug 修复
- 修复了账户变更后首页数据不更新的问题
- 通过 NotificationCenter 实现了跨视图数据更新通知机制
- 确保首页的总存款、净存款、借入、借出金额能实时反映账户变化
- 修复了 Account 模型缺少 Equatable 协议导致的编译错误

### 2025-12-05

#### Bug 修复
- 修复了分类添加后无法保存的问题，确保分类数据正确持久化到 UserDefaults
- 修复了分类图标处理逻辑，防止空字符串作为图标保存

### 2025-12-04

#### 功能增强
- 实现了数据持久化功能，创建了 PersistentDataService 使用 UserDefaults 存储数据
- 更新了所有 ViewModel 以使用持久化数据服务替代内存数据服务
- 修复了添加账户、分类、成员后在新建流水时无法看到的问题
- 修复了数据在应用重启后丢失的问题
- 完善了收入、支出和借贷的保存逻辑，确保数据正确写入持久化存储

### 2025-12-02

#### 功能增强
- 增强了收入添加功能：必须选择分类和成员才可以保存，实时显示每个账户存入的金额
- 增强了支出添加功能：必须选择账户、成员和分类才可以保存
- 增强了借贷添加功能：必须选择账户和成员才可以保存
- 改进了所有添加表单的用户交互体验，添加了必填项验证和友好的提示信息

### 2025-12-01

#### Bug 修复
- 修复了 TransactionsView 中 AddTransactionView 缺少 memberId 参数的问题
- 更新了 AddTransactionView 以支持成员选择功能
- 同步更新了 TransactionViewModel 中的 addTransaction 方法调用

### 2025-11-30

#### Bug 修复
- 修复了 TransactionsView 中由于视图层级过于复杂导致的编译器类型检查超时问题
- 通过将复杂表达式分解为独立的视图变量，优化了 SwiftUI 视图结构

### 2025-11-29

#### Bug 修复
- 修复了 TransactionViewModel 中 getTransactions 方法名冲突问题，通过明确区分参数标签避免重复声明错误
- 修复了 SettingsView 中已弃用的 onChange 方法，更新为 iOS 17 兼容的语法格式

### 2025-11-28

#### Bug 修复
- 修复了 DataServiceProtocol 中 getTransactions 和 getLoans 方法名冲突问题
- 通过明确区分参数标签（forAccount、forMember）避免了重复声明错误
- 更新了协议定义和实现以确保方法签名的唯一性

### 2025-11-27

#### 新增功能
- 实现了成员与收入、支出、借贷交易的关联功能
- 在收入、支出和借贷记录中添加了成员选择选项
- 增强了数据服务层以支持基于成员的查询功能

### 2025-11-26

#### Bug 修复
- 修复了收入、支出和借贷页面中存在的 NavigationView 嵌套问题

### 2025-11-25

#### Bug 修复
- 修复了编译器类型检查问题，通过分解复杂视图表达式为独立的视图变量解决

### 2025-11-24

#### 新增功能
- 移除了底部导航栏的账户按钮
- 在设置页面中增加了完整的账户管理功能（新增、修改、删除账户）
- 在设置页面中增加了分类管理功能（新增、修改、删除支出和收入分类）
- 在设置页面中增加了成员管理功能（新增、修改、删除成员）
- 实现了账户收入分配比例功能，用于按比例分配收入到不同账户
- 在设置中增加了本地备份和恢复功能（占位实现）
- 实现了首页快速记录功能，点击收入、支出、借贷按钮从下方弹出页面

#### 功能增强
- 增强了设置页面，提供了更完整的配置选项
- 优化了数据服务层，增加了成员管理相关接口
- 改进了首页快速记录功能，提供更好的用户体验

### 2025-11-23

#### 功能增强
- 将统计页面中的资金趋势图从条形图升级为曲线图
- 新增曲线图支持收入和支出两条曲线的对比显示
- 添加了网格线和图例，提升图表可读性
- 实现了平滑的贝塞尔曲线，使数据趋势更加直观
- 在数据点上添加了圆形标记，方便查看具体数值点

#### 新增功能
- 实现了基础项目框架和 MVVM 架构
- 创建了核心数据模型：Account（账户）、Transaction（交易）、Category（分类）、Loan（借贷）、IncomeAllocation（收入分配）
- 实现了内存数据服务（InMemoryDataService）用于数据存储和检索
- 开发了主界面和标签导航系统
- 完成了账户管理模块（AccountsView）和支持的 ViewModel
- 完成了交易记录模块（TransactionsView）和支持的 ViewModel
- 完成了分类管理模块的支持 ViewModel
- 完成了借贷管理模块的支持 ViewModel
- 增加了设置和统计页面的基本框架
- 扩展了数据服务功能，增加多种查询和筛选方法

#### 功能增强
- 增强了交易记录页面，支持按日期分组显示
- 实现了交易记录编辑功能，支持修改和删除交易
- 优化了用户界面交互体验

## 许可证

本项目仅供学习和参考使用。